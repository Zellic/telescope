(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{1942:function(e,t,n){Promise.resolve().then(n.bind(n,6571))},6571:function(e,t,n){"use strict";n.d(t,{default:function(){return k}});var s,a,l=n(7437),r=n(2265),c=n(9386),i=n(20),o=n(9629),u=n(9139),d=n(964),h=n(3908),m=n(1272),x=n(4794);let p=[{name:"NAME",uid:"name"},{name:"STATUS",uid:"status"},{name:"AUTHENTICATION",uid:"authentication"},{name:"ACTIONS",uid:"actions"}];function g(e){let t=r.useCallback((t,n)=>{let s="warning";switch("AuthorizationSuccess"===t.status.stage?s="success":("AuthorizationFailed"===t.status.stage||!0===t.status.inputRequired)&&(s="danger"),n){case"name":var a,r,i;return(0,l.jsx)("div",{className:"flex",children:(0,l.jsxs)("div",{className:"flex flex-col",children:[(0,l.jsx)("p",{className:"text-bold text-sm capitalize",children:null!==(r=null!==(a=t.username)&&void 0!==a?a:t.name)&&void 0!==r?r:"<no username>"}),(0,l.jsx)("p",{className:"text-bold text-sm capitalize text-default-400",children:11===(i=t.phone).length?"+".concat(i[0],"-").concat(i.slice(1,4),"-").concat(i.slice(4,7),"-").concat(i.slice(7)):10===i.length?"".concat(i.slice(0,3),"-").concat(i.slice(3,6),"-").concat(i.slice(6)):7===i.length?"".concat(i.slice(0,3),"-").concat(i.slice(3)):i})]})});case"status":return(0,l.jsx)(c.z,{className:"capitalize",color:s,size:"sm",variant:"flat",children:t.status.stage});case"authentication":if("success"===s)return null;return(0,l.jsx)(x.A,{isLoading:"warning"===s,onClick:()=>{e.onProvideClicked(t)},children:"Provide"});case"actions":return(0,l.jsx)("div",{className:"relative flex items-center gap-2"})}},[]);return(0,l.jsxs)(i.b,{"aria-label":"Example table with custom cells",children:[(0,l.jsx)(o.J,{columns:p,children:e=>(0,l.jsx)(u.j,{align:"actions"===e.uid?"center":"start",children:e.name},e.uid)}),(0,l.jsx)(d.y,{items:e.users,children:e=>(0,l.jsxs)(h.g,{children:[(0,l.jsx)(m.X,{children:t(e,"name")}),(0,l.jsx)(m.X,{children:t(e,"status")}),(0,l.jsx)(m.X,{children:t(e,"authentication")}),(0,l.jsx)(m.X,{children:t(e,"actions")})]},e.phone)})]})}class j{static getInstance(){return j.instance||(j.instance=new j),j.instance}async request(e,t){try{let n=await fetch("".concat(this.baseURL).concat(e),t),s=await n.json();if(!n.ok)return{success:!1,error:s.error||"Unknown error occurred"};return{success:!0,data:s}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Unknown error occurred"}}}async getClients(e){return e?this.request("/clients?hash="+e):this.request("/clients")}async submitValue(e,t,n){return this.request("/submitvalue",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phone:e,stage:t,value:n})})}async addAccount(e,t,n){return this.request("/addtgaccount",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phone_number:e,email:t,comment:n})})}constructor(){let e=window.location.protocol,t=window.location.hostname,n="https:"===e?"https":"http";if("localhost"===t)this.baseURL="".concat(n,"://localhost:8888");else{let e=window.location.port;""==e?this.baseURL="".concat(n,"://").concat(t):this.baseURL="".concat(n,"://").concat(t,":").concat(e)}}}var f=n(9834),b=n(9991),v=n(5448),C=n(6801),y=n(1496),w=n(9960),S=n(5256),E=n(1025),R=n(7971),A=n(5410),N=n(5286);let P={PasswordRequired:{name:"PasswordRequired",inputType:"text",label:"Password",placeholder:"Enter the account password"},AuthCodeRequired:{name:"AuthCodeRequired",inputType:"text",label:"Auth Code",placeholder:"Enter the Telegram auth code"},EmailCodeRequired:{name:"EmailCodeRequired",inputType:"text",label:"E-mail code",placeholder:"Enter code from email"}};function O(e){let{isOpen:t,onOpenChange:n}=(0,C.q)({isOpen:e.isOpen}),s=e.isOpen?P[e.user.status.stage]:null;return(0,l.jsx)(y.R,{isOpen:t,onOpenChange:n,onClose:()=>{e.onClose()},children:(0,l.jsx)(w.A,{children:t=>(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(S.k,{className:"flex flex-col gap-1",children:e.user.status.stage}),e.submitting?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(E.I,{children:"Submitting..."}),(0,l.jsx)(R.R,{children:(0,l.jsx)(b.c,{})})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(E.I,{children:[(0,l.jsx)("p",{children:"Please enter the thingy."}),(0,l.jsx)("div",{children:(0,l.jsx)(N.Y,{isRequired:!0,type:s.inputType,label:s.label,placeholder:s.placeholder,value:e.inputValue[0],onValueChange:t=>{e.inputValue[1](t)}})})]}),(0,l.jsxs)(R.R,{children:[(0,l.jsx)(A.A,{color:"danger",variant:"light",onPress:t,children:"Close"}),(0,l.jsx)(A.A,{color:"primary",onPress:()=>{var t;t=e.inputValue[0],e.onSubmit(t)},children:"Submit"})]})]})]})})})}function T(e){return e&&e.length>0?e:null}function q(e){let{isOpen:t,onOpenChange:n}=(0,C.q)({isOpen:!0}),[s,a]=(0,r.useState)(!1),[c,i]=(0,r.useState)(""),[o,u]=(0,r.useState)(""),[d,h]=(0,r.useState)("");return(0,l.jsx)(y.R,{isOpen:t,isDismissable:!s,onOpenChange:n,onClose:()=>{e.onClose()},children:(0,l.jsx)(w.A,{children:t=>(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(S.k,{className:"flex flex-col gap-1",children:"Add Telegram Account"}),s?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(E.I,{children:"Submitting..."}),(0,l.jsx)(R.R,{children:(0,l.jsx)(b.c,{})})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(E.I,{children:(0,l.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,l.jsx)(N.Y,{isRequired:!0,type:"text",label:"Phone number",placeholder:"Enter  phone number...",labelPlacement:"outside",maxLength:11,pattern:"d{11}",value:c,onValueChange:e=>{i(e)}}),(0,l.jsx)(N.Y,{isRequired:!1,type:"email",label:"E-mail",placeholder:"Enter email...",labelPlacement:"outside",maxLength:255,value:o,onValueChange:e=>{u(e)}}),(0,l.jsx)(N.Y,{isRequired:!1,type:"text",label:"Comment",placeholder:"Account belongs to...",labelPlacement:"outside",maxLength:300,value:d,onValueChange:e=>{h(e)}})]})}),(0,l.jsxs)(R.R,{children:[(0,l.jsx)(A.A,{color:"danger",variant:"light",onPress:t,children:"Close"}),(0,l.jsx)(A.A,{color:"primary",onPress:()=>{a(!0),e.onSubmit({phone:c,email:T(o),comment:T(d)})},children:"Submit"})]})]})]})})})}function k(){let[e,t]=(0,r.useState)(null),n=(0,r.useRef)(null),[s,a]=(0,r.useState)(!1),[c,i]=(0,r.useState)(!1),[o,u]=(0,r.useState)(null),[d,h]=(0,r.useState)(!1),m=(0,r.useState)(""),[p,C]=(0,r.useState)(0),y=(0,r.useCallback)(async()=>{if(!c){a(!0);try{let e=j.getInstance(),s=await e.getClients(n.current);s.success?(s.data.hash!==n.current&&t(s.data.items),n.current=s.data.hash):console.error("Error fetching from server: ".concat(s.error)),i(!s.success)}catch(e){console.error("Error fetching clients: ",e),i(!0)}finally{a(!1)}}},[c]);if(!function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];arguments.length>3&&void 0!==arguments[3]&&arguments[3];let s=function(){let e=(0,r.useRef)(!0);return(0,r.useEffect)(()=>{let t=()=>{e.current=!document.hidden};return document.addEventListener("visibilitychange",t),()=>{document.removeEventListener("visibilitychange",t)}},[]),e}();!function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],s=!(arguments.length>3)||void 0===arguments[3]||arguments[3],a=(0,r.useRef)(),l=(0,r.useRef)(!1),c=(0,r.useRef)(!1);(0,r.useEffect)(()=>{a.current=t},[t]);let i=(0,r.useCallback)(async()=>{if(!l.current){l.current=!0;try{var e;await (null===(e=a.current)||void 0===e?void 0:e.call(a))}finally{l.current=!1,c.current=!0}}},[]);(0,r.useEffect)(()=>{s?i():c.current=!0},[]),(0,r.useEffect)(()=>{if(null!==e){let t=setInterval(()=>{c.current&&i()},e);return()=>clearInterval(t)}},[e,i,...n])}(e,(0,r.useCallback)(async()=>{s.current&&await t()},[t]),n)}(5e3,y,[y]),c)return(0,l.jsx)(f.w,{children:(0,l.jsx)(v.G,{children:"Failed to reach server. Please try again later."})});async function w(e){C(2),(await j.getInstance().addAccount(e.phone,e.email,e.comment)).success,C(0)}return(0,l.jsxs)(l.Fragment,{children:[0===p?null:(0,l.jsx)(q,{onClose:()=>{C(0)},onSubmit:e=>{w(e)}}),(0,l.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,l.jsx)(O,{submitting:d,isOpen:null!==o,onClose:()=>{u(null)},onSubmit:n=>{m[1](""),function(n){(async()=>{try{let s=j.getInstance();h(!0);let a=await s.submitValue(null==o?void 0:o.phone,null==o?void 0:o.status.stage,n);if(await new Promise(e=>setTimeout(e,2e3)),h(!1),a.success){if(null===e||null===o)return;let n=e.map(e=>e.phone===o.phone?{...e,status:{...e.status,inputRequired:!1}}:e);t(n)}else console.error("Error submitting code to server: ".concat(a.error)),i(!0)}catch(e){console.error("Error submitting code to server: ",e),i(!0)}u(null)})()}(n)},inputValue:m,user:o}),null===e?(0,l.jsx)(f.w,{children:(0,l.jsx)(v.G,{children:"Waiting for data..."})}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"flex gap-4 justify-between",children:[(0,l.jsx)("span",{}),(0,l.jsx)(x.A,{size:"sm",onClick:()=>{C(1)},children:"Add Account"})]}),(0,l.jsx)(g,{users:e,onProvideClicked:function(e){u(e)}})]})]}),(0,l.jsx)("div",{children:s&&(0,l.jsx)(b.c,{})})]})}(s=a||(a={}))[s.CLOSED=0]="CLOSED",s[s.OPEN=1]="OPEN",s[s.SUBMITTING=2]="SUBMITTING"}},function(e){e.O(0,[974,420,971,23,744],function(){return e(e.s=1942)}),_N_E=e.O()}]);