(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{1942:function(e,n,t){Promise.resolve().then(t.bind(t,2361))},2361:function(e,n,t){"use strict";t.d(n,{default:function(){return U}});var s,l,a=t(7437),r=t(2265),c=t(9386),i=t(8740),o=t(9629),u=t(9139),d=t(964),h=t(3908),m=t(1272),x=t(4794);let p=[{name:"NAME",uid:"name"},{name:"STATUS",uid:"status"},{name:"AUTHENTICATION",uid:"authentication"},{name:"ACTIONS",uid:"actions"}];function j(e){let n=r.useCallback((n,t)=>{let s="warning";switch("AuthorizationSuccess"===n.status.stage?s="success":("AuthorizationFailed"===n.status.stage||!0===n.status.inputRequired)&&(s="danger"),t){case"name":var l,r,i;return(0,a.jsx)("div",{className:"flex",children:(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("p",{className:"text-bold text-sm capitalize",children:null!==(r=null!==(l=n.username)&&void 0!==l?l:n.name)&&void 0!==r?r:"<no username>"}),(0,a.jsx)("p",{className:"text-bold text-sm capitalize text-default-400",children:11===(i=n.phone).length?"+".concat(i[0],"-").concat(i.slice(1,4),"-").concat(i.slice(4,7),"-").concat(i.slice(7)):10===i.length?"".concat(i.slice(0,3),"-").concat(i.slice(3,6),"-").concat(i.slice(6)):7===i.length?"".concat(i.slice(0,3),"-").concat(i.slice(3)):i})]})});case"status":return(0,a.jsx)(c.z,{className:"capitalize",color:s,size:"sm",variant:"flat",children:n.status.stage});case"authentication":if("success"===s)return null;return(0,a.jsx)(x.A,{isLoading:"warning"===s,onClick:()=>{e.onProvideClicked(n)},children:"Provide"});case"actions":return(0,a.jsx)("div",{className:"relative flex items-center gap-2",children:e.renderActionButtons(n)})}},[]);return(0,a.jsxs)(i.b,{"aria-label":"Example table with custom cells",children:[(0,a.jsx)(o.J,{columns:p,children:e=>(0,a.jsx)(u.j,{align:"actions"===e.uid?"center":"start",children:e.name},e.uid)}),(0,a.jsx)(d.y,{items:e.users,children:e=>(0,a.jsxs)(h.g,{children:[(0,a.jsx)(m.X,{children:n(e,"name")}),(0,a.jsx)(m.X,{children:n(e,"status")}),(0,a.jsx)(m.X,{children:n(e,"authentication")}),(0,a.jsx)(m.X,{children:n(e,"actions")})]},e.phone)})]})}class g{static getInstance(){return g.instance||(g.instance=new g),g.instance}async request(e,n){try{let t=await fetch("".concat(this.baseURL).concat(e),n),s=await t.json();if(!t.ok)return{success:!1,error:s.error||"Unknown error occurred"};return{success:!0,data:s}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Unknown error occurred"}}}async getClients(e){return e?this.request("/clients?hash="+e):this.request("/clients")}async submitValue(e,n,t){return this.request("/submitvalue",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phone:e,stage:n,value:t})})}async addAccount(e,n,t){return this.request("/addtgaccount",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phone_number:e,email:n,comment:t})})}constructor(){let e=window.location.protocol,n=window.location.hostname,t="https:"===e?"https":"http";if("localhost"===n)this.baseURL="".concat(t,"://localhost:8888");else{let e=window.location.port;""==e?this.baseURL="".concat(t,"://").concat(n):this.baseURL="".concat(t,"://").concat(n,":").concat(e)}}}var f=t(9834),v=t(8941),b=t(9991),C=t(5448),y=t(6801),w=t(1496),A=t(9960),S=t(5256),E=t(1025),R=t(7971),O=t(1094),N=t(5286);let P={PasswordRequired:{name:"PasswordRequired",inputType:"text",label:"Password",placeholder:"Enter the account password"},AuthCodeRequired:{name:"AuthCodeRequired",inputType:"text",label:"Auth Code",placeholder:"Enter the Telegram auth code"},EmailCodeRequired:{name:"EmailCodeRequired",inputType:"text",label:"E-mail code",placeholder:"Enter code from email"}};function T(e){let{isOpen:n,onOpenChange:t}=(0,y.q)({isOpen:e.isOpen}),s=e.isOpen?P[e.user.status.stage]:null;return(0,a.jsx)(w.R,{isOpen:n,onOpenChange:t,onClose:()=>{e.onClose()},children:(0,a.jsx)(A.A,{children:n=>(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(S.k,{className:"flex flex-col gap-1",children:e.user.status.stage}),e.submitting?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(E.I,{children:"Submitting..."}),(0,a.jsx)(R.R,{children:(0,a.jsx)(b.c,{})})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(E.I,{children:[(0,a.jsx)("p",{children:"Please enter the thingy."}),(0,a.jsx)("div",{children:(0,a.jsx)(N.Y,{isRequired:!0,type:s.inputType,label:s.label,placeholder:s.placeholder,value:e.inputValue[0],onValueChange:n=>{e.inputValue[1](n)}})})]}),(0,a.jsxs)(R.R,{children:[(0,a.jsx)(O.A,{color:"danger",variant:"light",onPress:n,children:"Close"}),(0,a.jsx)(O.A,{color:"primary",onPress:()=>{var n;n=e.inputValue[0],e.onSubmit(n)},children:"Submit"})]})]})]})})})}function q(e){return e&&e.length>0?e:null}function k(e){let{isOpen:n,onOpenChange:t}=(0,y.q)({isOpen:!0}),[s,l]=(0,r.useState)(!1),[c,i]=(0,r.useState)(""),[o,u]=(0,r.useState)(""),[d,h]=(0,r.useState)("");return(0,a.jsx)(w.R,{isOpen:n,isDismissable:!s,onOpenChange:t,onClose:()=>{e.onClose()},children:(0,a.jsx)(A.A,{children:n=>(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(S.k,{className:"flex flex-col gap-1",children:"Add Telegram Account"}),s?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(E.I,{children:"Submitting..."}),(0,a.jsx)(R.R,{children:(0,a.jsx)(b.c,{})})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(E.I,{children:(0,a.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,a.jsx)(N.Y,{isRequired:!0,type:"text",label:"Phone number",placeholder:"Enter  phone number...",labelPlacement:"outside",maxLength:11,pattern:"d{11}",value:c,onValueChange:e=>{i(e)}}),(0,a.jsx)(N.Y,{isRequired:!1,type:"email",label:"E-mail",placeholder:"Enter email...",labelPlacement:"outside",maxLength:255,value:o,onValueChange:e=>{u(e)}}),(0,a.jsx)(N.Y,{isRequired:!1,type:"text",label:"Comment",placeholder:"Account belongs to...",labelPlacement:"outside",maxLength:300,value:d,onValueChange:e=>{h(e)}})]})}),(0,a.jsxs)(R.R,{children:[(0,a.jsx)(O.A,{color:"danger",variant:"light",onPress:n,children:"Close"}),(0,a.jsx)(O.A,{color:"primary",onPress:()=>{l(!0),e.onSubmit({phone:c,email:q(o),comment:q(d)})},children:"Submit"})]})]})]})})})}function I(e){let{isOpen:n,onOpenChange:t}=(0,y.q)({isOpen:e.isOpen});return(0,a.jsx)(w.R,{isOpen:n,onOpenChange:t,onClose:e.onClose,children:(0,a.jsx)(A.A,{children:n=>(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(S.k,{className:"flex flex-col gap-1",children:e.title}),(0,a.jsx)(E.I,{children:(0,a.jsx)("p",{children:e.message})}),(0,a.jsx)(R.R,{children:(0,a.jsx)(O.A,{color:"primary",onPress:n,children:"Close"})})]})})})}var F=t(2708);let L=[{unit:"year",seconds:31104e3},{unit:"month",seconds:2592e3},{unit:"day",seconds:86400},{unit:"hour",seconds:3600},{unit:"minute",seconds:60},{unit:"second",seconds:1}];function U(){var e,n;let[t,s]=(0,r.useState)(null),l=(0,r.useRef)(null),[c,i]=(0,r.useState)(!1),[o,u]=(0,r.useState)(!1),[d,h]=(0,r.useState)(null),[m,p]=(0,r.useState)(!1),y=(0,r.useState)(""),[w,A]=(0,r.useState)(0),[S,E]=(0,r.useState)(null),R=(0,r.useCallback)(async()=>{if(!o){i(!0);try{let e=g.getInstance(),n=await e.getClients(l.current);n.success?(n.data.hash!==l.current&&s(n.data.items),l.current=n.data.hash):console.error("Error fetching from server: ".concat(n.error)),u(!n.success)}catch(e){console.error("Error fetching clients: ",e),u(!0)}finally{i(!1)}}},[o]);if(!function(e,n){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];arguments.length>3&&void 0!==arguments[3]&&arguments[3];let s=function(){let e=(0,r.useRef)(!0);return(0,r.useEffect)(()=>{let n=()=>{e.current=!document.hidden};return document.addEventListener("visibilitychange",n),()=>{document.removeEventListener("visibilitychange",n)}},[]),e}();!function(e,n){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],s=!(arguments.length>3)||void 0===arguments[3]||arguments[3],l=(0,r.useRef)(),a=(0,r.useRef)(!1),c=(0,r.useRef)(!1);(0,r.useEffect)(()=>{l.current=n},[n]);let i=(0,r.useCallback)(async()=>{if(!a.current){a.current=!0;try{var e;await (null===(e=l.current)||void 0===e?void 0:e.call(l))}finally{a.current=!1,c.current=!0}}},[]);(0,r.useEffect)(()=>{s?i():c.current=!0},[]),(0,r.useEffect)(()=>{if(null!==e){let n=setInterval(()=>{c.current&&i()},e);return()=>clearInterval(n)}},[e,i,...t])}(e,(0,r.useCallback)(async()=>{s.current&&await n()},[n]),t)}(5e3,R,[R]),o)return(0,a.jsx)(f.w,{children:(0,a.jsx)(C.G,{children:"Failed to reach server. Please try again later."})});async function O(e){A(2);let n=await g.getInstance().addAccount(e.phone,e.email,e.comment);n.success||E({title:"Error",content:"Failed to add account: ".concat(n.error)}),A(0)}return(0,a.jsxs)(a.Fragment,{children:[0===w?null:(0,a.jsx)(k,{onClose:()=>{A(0)},onSubmit:e=>{O(e)}}),(0,a.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,a.jsx)(I,{isOpen:null!=S,onClose:()=>{E(null)},title:null!==(e=null==S?void 0:S.title)&&void 0!==e?e:"",message:null!==(n=null==S?void 0:S.content)&&void 0!==n?n:""}),(0,a.jsx)(T,{submitting:m,isOpen:null!==d,onClose:()=>{h(null)},onSubmit:e=>{y[1](""),function(e){(async()=>{try{let n=g.getInstance();p(!0);let l=await n.submitValue(null==d?void 0:d.phone,null==d?void 0:d.status.stage,e);if(await new Promise(e=>setTimeout(e,2e3)),p(!1),l.success){if(null===t||null===d)return;let e=t.map(e=>e.phone===d.phone?{...e,status:{...e.status,inputRequired:!1}}:e);s(e)}else console.error("Error submitting code to server: ".concat(l.error)),u(!0)}catch(e){console.error("Error submitting code to server: ",e),u(!0)}h(null)})()}(e)},inputValue:y,user:d}),null===t?(0,a.jsx)(f.w,{children:(0,a.jsx)(C.G,{children:"Waiting for data..."})}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex gap-4 justify-between",children:[(0,a.jsx)("span",{}),(0,a.jsx)(x.A,{size:"sm",onClick:()=>{A(1)},children:"Add Account"})]}),(0,a.jsx)(j,{users:t,onProvideClicked:function(e){h(e)},renderActionButtons:e=>(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(v.e,{content:"Retrieve auth code",children:(0,a.jsx)(x.A,{isIconOnly:!0,color:"default","aria-label":"Retrieve auth code",isDisabled:!e.lastCode,onClick:()=>{var n;E({title:"Auth code",content:"As of ".concat((n=e.lastCode.date,function(e){for(let{unit:n,seconds:t}of L)if(e>=t){let s=Math.floor(e/t);return"".concat(s," ").concat(n).concat(1!==s?"s":"")}return"0 seconds"}(Math.floor(Date.now()/1e3)-n))," ago the login code is: ").concat(e.lastCode.value)})},children:(0,a.jsx)(F.t,{})})})})})]})]}),(0,a.jsx)("div",{children:c&&(0,a.jsx)(b.c,{})})]})}(s=l||(l={}))[s.CLOSED=0]="CLOSED",s[s.OPEN=1]="OPEN",s[s.SUBMITTING=2]="SUBMITTING"}},function(e){e.O(0,[265,624,971,23,744],function(){return e(e.s=1942)}),_N_E=e.O()}]);